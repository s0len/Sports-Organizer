######################################################################
# Playbook Sample Configuration
######################################################################
# This annotated example is designed to be copied to `playbook.yaml`
# and tweaked for your environment. Comments call out what each block
# controls so you can quickly adapt it for new sports or release formats.
#
# Key ideas:
#   * `settings` control the global behavior of the organizer.
#   * `pattern_sets` describe how to recognize and normalize filenames.
#   * `sports` tie pattern sets to metadata sources and per-sport tweaks.
#
# Tips for customization:
#   * Strings like ${SOURCE_DIR:-/data/source} can be overridden via env vars.
#   * Templates such as "{season_number:02d}" use Python's format syntax.
#   * Regular expressions use Python-style syntax; `(?i)` makes them case-insensitive.
######################################################################

settings:
  ####################################################################
  # REQUIRED DIRECTORIES
  ####################################################################
  source_dir: ${SOURCE_DIR:-/data/source} # Where Playbook looks for newly downloaded media files.
  destination_dir: ${DESTINATION_DIR:-/data/destination} # Destination root for organized media. Files are written here (or hard-linked).
  cache_dir: ${CACHE_DIR:-/var/cache/playbook} # Location for metadata caches, fingerprints, and temp state.

  ####################################################################
  # EXECUTION BEHAVIOUR
  ####################################################################
  dry_run: false          # When true, identify matches and log actions without touching the filesystem.
  skip_existing: true     # When true, leave destinations alone unless a better (e.g. PROPER/REPACK) source is detected.
  poll_interval: 0        # Seconds between passes in watch mode. Use 0 to run once and exit.
  link_mode: hardlink     # Global default for linking: hardlink | copy | symlink.

  ####################################################################
  # NOTIFICATIONS (OPTIONAL)
  ####################################################################
  discord_webhook_url: ${DISCORD_WEBHOOK_URL:-} # Discord webhook for processed notifications. Leave empty to disable.
  notifications:
    batch_daily: false    # When true, send one message per sport/day and edit it with new entries instead of posting each file.
    flush_time: "00:00"   # Local HH:MM (or HH:MM:SS) boundary for the batching day rollover. Useful for overnight events.
    targets:              # Optional explicit targets. Leave empty to fall back to `discord_webhook_url`.
      - type: discord
        webhook_url: ${DISCORD_WEBHOOK_URL:-} # Override the default webhook per target (optional).
      - type: autoscan
        url: ${AUTOSCAN_URL:-http://autoscan:3030} # Base Autoscan URL; delete this block if not using Autoscan.
        trigger: manual       # Autoscan trigger name; `manual` works with the built-in manual endpoint.
        username: ${AUTOSCAN_USERNAME:-} # Optional basic auth credentials for Autoscan.
        password: ${AUTOSCAN_PASSWORD:-}
        rewrite:              # Rewrite Playbook's destination paths to whatever Autoscan/Plex can see.
          - from: ${DESTINATION_DIR:-/data/destination}
            to: /mnt/unionfs/Media

  ####################################################################
  # FILESYSTEM WATCHER (OPTIONAL)
  ####################################################################
  file_watcher:
    enabled: false        # When true, rely on filesystem events instead of fixed poll intervals.
    paths: []             # Directories to watch; defaults to source_dir when empty. Relative paths resolve under source_dir.
    include: []           # Optional glob filters (e.g. "*.mkv") to limit which files trigger a run.
    ignore:               # Globs that should never trigger a run.
      - "*.part"
      - "*.tmp"
    debounce_seconds: 5   # Minimum number of seconds between watcher-triggered processor runs.
    reconcile_interval: 900 # Run a full scan every N seconds even if no events arrive. Set 0 to disable.

  ####################################################################
  # KOMETA CRONJOB TRIGGER (OPTIONAL)
  ####################################################################
  # Enable this to have Playbook kick Kometa right after the first newly ingested
  # file each run. You can point it at the in-cluster CronJob or fall back to a
  # simple `docker run` command when you're not on Kubernetes.
  kometa_trigger:
    enabled: false
    mode: kubernetes         # kubernetes | docker
    namespace: media
    cronjob_name: kometa-sport
    job_name_prefix: kometa-sport-triggered-by-playbook
    docker:
      binary: docker
      image: kometateam/kometa
      config_path: /absolute/path/to/kometa/config
      container_path: /config
      volume_mode: rw
      libraries: "Sports|TV Shows - 4K"
      extra_args: []         # Additional CLI args (e.g. '--config', '/config/config.yml')
      remove_container: true
      interactive: false
      # container_name: kometa   # Uncomment to exec into an already-running container instead of docker run
      # exec_python: python3
      # exec_script: /app/kometa/kometa.py

  ####################################################################
  # DEFAULT DESTINATION TEMPLATES
  ####################################################################
  # These templates are used for every sport unless overridden under that sport's `destination` block.
  destination:
    root_template: "{show_title}" # Top-level folder pattern for each sport/show.
    season_dir_template: "{season_number:02d} {season_title}" # Sub-folder per season or round (zero-padded for ordering).
    episode_template: "{show_title} - S{season_number:02d}E{episode_number:02d} - {episode_title}.{extension}" # Final filename.


######################################################################
# Pattern Sets - reusable filename matchers grouped by sport
#
# Each entry is a list of regex-driven matchers. Captured groups feed into
# `season_selector` and `episode_selector`. Built-in templates live in
# `pattern_templates.yaml` and are referenced from `sports` via the
# `pattern_sets` list.
######################################################################

pattern_sets:
  # Built-in pattern templates load automatically from `pattern_templates.yaml`.
  # Available names: formula1, formula_e, indycar, motogp, moto2, moto3, world_superbike, world_supersport, isle_of_man_tt, football, premier_league, ufc, uefa_champions_league, figure_skating_grand_prix.
  # Add custom sets below if you need overrides or extra matchers.
  # Example:
  #   my_custom_pack:
  #     - description: Custom fallback matcher
  #       regex: >-
  #         (?i)^Example\.(?P<year>\d{4})\.(?P<session>.+)$
  #       season_selector:
  #         mode: round
  #         group: year
  #       episode_selector:
  #         group: session

######################################################################
# Sports - tie pattern sets to metadata, variants, and overrides
#
# Each sport declares:
#   * `source_globs` to pick up matching downloads.
#   * `pattern_sets` to pull in built-in matchers (or `file_patterns` for inline setups).
#   * Optional metadata endpoints and per-year overrides.
######################################################################

sports:
  - id: formula1
    name: Formula 1
    enabled: true

    # Filenames that should be considered for Formula 1 processing.
    source_globs:
      - "Formula.1.*"
      - "Formula1.*"
      - "Formula1 *"
      - "Formula 1 *"
      - "formula1.*"
      - "formula1 *"
      - "formula 1 *"

    # Use the built-in Formula 1 pattern template.
    pattern_sets:
      - formula1

    # Optional per-season metadata sources. Useful when schedules change.
    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/formula1/2025.yaml
          show_key: Formula 1 2025
          ttl_hours: 24
          season_overrides:
            Pre-Season Testing:
              season_number: 0
              round: 0

  - id: formula_e
    name: Formula E
    enabled: true

    source_globs:
      - "FormulaE.*"
      - "FormulaE *"
      - "Formula.E.*"
      - "Formula E *"
      - "formulae.*"
      - "formulae *"
      - "formula.e.*"
      - "formula e *"

    pattern_sets:
      - formula_e

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/formula-e/2024-2025.yaml
          show_key: Formula E 2024-2025
          ttl_hours: 24
      - year: 2026
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/formula-e/2025-2026.yaml
          show_key: Formula E 2025-2026
          ttl_hours: 24

  - id: indycar
    name: NTT IndyCar Series
    enabled: true

    source_globs:
      - "IndyCar.*"
      - "IndyCar *"
      - "IndyCar.Series.*"
      - "IndyCar Series *"
      - "indycar.*"
      - "indycar *"
      - "indycar.series.*"
      - "indycar series *"

    pattern_sets:
      - indycar

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/indycar/2025.yaml
          show_key: NTT IndyCar Series 2025
          ttl_hours: 24
      - year: 2026
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/indycar/2026.yaml
          show_key: NTT IndyCar Series 2026
          ttl_hours: 24

  - id: motogp
    name: MotoGP
    enabled: true

    source_globs:
      - "MotoGP.*"
      - "MotoGP *"
      - "motogp.*"
      - "motogp *"

    # Use the built-in MotoGP pattern template.
    pattern_sets:
      - motogp

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/motogp/2025.yaml
          show_key: MotoGP 2025
          ttl_hours: 24
      - year: 2024
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/motogp/2024.yaml
          show_key: MotoGP 2024
          ttl_hours: 24
      - year: 2023
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/motogp/2023.yaml
          show_key: MotoGP 2023
          ttl_hours: 24

  - id: moto2
    name: Moto2
    enabled: true

    source_globs:
      - "Moto2.*"
      - "Moto2 *"
      - "moto2.*"
      - "moto2 *"

    # Use the built-in Moto2 pattern template.
    pattern_sets:
      - moto2

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/moto2/2025.yaml
          show_key: Moto2 2025
          ttl_hours: 24

  - id: moto3
    name: Moto3
    enabled: true

    source_globs:
      - "Moto3.*"
      - "Moto3 *"
      - "moto3.*"
      - "moto3 *"

    # Use the built-in Moto3 pattern template.
    pattern_sets:
      - moto3

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/moto3/2025.yaml
          show_key: Moto3 2025
          ttl_hours: 24

  - id: world_supersport
    name: World Supersport
    enabled: true

    source_globs:
      - "WSSP.*"
      - "WSSP *"
      - "World.Supersport.*"
      - "World Supersport *"
      - "world.supersport.*"
      - "world supersport *"

    pattern_sets:
      - world_supersport

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wssp-2025.yaml
          show_key: World Supersport 2025
          ttl_hours: 24
      - year: 2024
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wssp-2024.yaml
          show_key: World Supersport 2024
          ttl_hours: 24
      - year: 2023
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wssp-2023.yaml
          show_key: World Supersport 2023
          ttl_hours: 24

  - id: world_superbike
    name: World Superbike
    enabled: true

    source_globs:
      - "WSBK.*"
      - "WSBK *"
      - "wsbk.*"
      - "wsbk *"
      - "World.Superbike.*"
      - "World Superbike *"
      - "WorldSuperbike.*"
      - "WorldSuperbike *"
      - "world.superbike.*"
      - "world superbike *"

    pattern_sets:
      - world_superbike

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wsbk-2025.yaml
          show_key: World Superbike 2025
          ttl_hours: 24
      - year: 2024
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wsbk-2024.yaml
          show_key: World Superbike 2024
          ttl_hours: 24
      - year: 2023
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/wsbk-2023.yaml
          show_key: World Superbike 2023
          ttl_hours: 24

  - id: isle_of_man_tt
    name: Isle of Man TT
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/isle-of-man-tt.yaml
      show_key: Isle of Man TT
      ttl_hours: 24

    source_globs:
      - "Isle*TT*"
      - "isle*tt*"
      - "IOMTT*"
      - "iomtt*"

    # Use the built-in Isle of Man TT template.
    pattern_sets:
      - isle_of_man_tt

    destination:
      season_dir_template: "{season_title}"
      episode_template: "{show_title} - S{season_number:02d}E{episode_number:02d} - {episode_title}.{extension}"

  - id: nfl
    name: NFL
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/nfl/2025.yaml
      show_key: NFL 2025
      ttl_hours: 24

    source_globs:
      - "NFL.*"
      - "NFL *"
      - "nfl.*"
      - "nfl *"

    # Use the built-in NFL template (pattern set name `nfl`).
    pattern_sets:
      - nfl

  - id: nba
    name: NBA
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/nba/2025-2026.yaml
      show_key: NBA 2025-2026
      ttl_hours: 24

    source_globs:
      - "NBA.*"
      - "NBA *"
      - "nba.*"
      - "nba *"

    # Use the built-in NBA template (pattern set name `nba`).
    pattern_sets:
      - nba

  - id: uefa_champions_league
    name: UEFA Champions League
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/uefa-champions-league/2025-2026.yaml
      show_key: UEFA Champions League 2025-2026
      ttl_hours: 24

    source_globs:
      - "UEFA Champions League *"
      - "UEFA Champions League*"
      - "UEFA.Champions.League.*"
      - "UEFA.Champions.League*"
      - "UEFA-Champions-League-*"
      - "UCL.*"
      - "UCL *"

    pattern_sets:
      - uefa_champions_league

  - id: figure_skating_grand_prix
    name: Figure Skating Grand Prix
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/figure-skating-grand-prix-2025.yaml
      show_key: Figure Skating Grand Prix 2025
      ttl_hours: 24

    source_globs:
      - "Figure Skating Grand Prix *"
      - "Figure Skating Grand Prix*"
      - "Figure.Skating.Grand.Prix.*"
      - "Figure.Skating.Grand.Prix*"
      - "Figure Skating * Grand Prix *"

    pattern_sets:
      - figure_skating_grand_prix

  - id: premier_league
    name: Premier League
    enabled: true

    metadata:
      url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/premier-league/2025-2026.yaml
      show_key: Premier League 2025-2026
      ttl_hours: 24

    source_globs:
      - "EPL.*"
      - "EPL *"
      - "epl.*"
      - "epl *"
      - "Premier.League.*"
      - "Premier League *"
      - "premier.league.*"
      - "premier league *"
      - "English.Premier.League.*"
      - "English Premier League *"

    # Use the built-in Premier League pattern template.
    pattern_sets:
      - premier_league

  - id: ufc
    name: UFC
    enabled: true

    variants:
      - year: 2025
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/ufc/2025.yaml
          show_key: UFC 2025
          ttl_hours: 24
      - year: 2024
        metadata:
          url: https://raw.githubusercontent.com/s0len/meta-manager-config/refs/heads/main/metadata/ufc/2024.yaml
          show_key: UFC 2024
          ttl_hours: 24
    
    source_globs:
      - "UFC.*"
      - "UFC *"
      - "ufc.*"
      - "ufc *"
    
    pattern_sets:
      - ufc
